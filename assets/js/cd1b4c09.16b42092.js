"use strict";(globalThis.webpackChunkrc_knob_docs=globalThis.webpackChunkrc_knob_docs||[]).push([[389],{3045(e,t,n){n.d(t,{An:()=>A,FE:()=>w,JU:()=>R,N6:()=>P,Q6:()=>y,WT:()=>k,gm:()=>C,l5:()=>$});var a=n(7900),r=n(2128);const s=(e,t,n)=>Math.max(e,Math.min(t,n)),i=({mouseAngle:e,angleOffset:t,angleRange:n})=>s(0,1,.5+((e-(t+.5*n)+900)%360-180)/n),l=({mouseAngle:e,multiRotation:t,angleOffset:n,angleRange:a,percentage:r,previousPercentage:s,previousMouseAngle:l})=>{if(null!==l){const r=(e-l)%360,i=r>180?-(360-r):r<-180?360+r:r;if(i>=120||i<=-120)return{updated:!1,mouseAngle:l,percentage:s};const o=s+i/a;if(!t&&(o<0||o>1)){return{updated:!0,mouseAngle:o<0?n:(n+a+720)%360,percentage:o<0?0:1}}return{updated:!0,mouseAngle:e,percentage:o}}if(t){const t=(i({angleOffset:n,angleRange:a,mouseAngle:e})+1-r%1)%1;return{updated:!0,mouseAngle:e,percentage:r+(t>.5?t-1:t)}}return{updated:!0,mouseAngle:e,percentage:i({angleOffset:n,angleRange:a,mouseAngle:e})}},o=(e,t,n)=>{if(!e.updated||!n)return e;const a=c(e.percentage,n),r=(t.angleOffset+t.angleRange*a)%360;return{...e,percentage:a,mouseAngle:r<0?r+360:r}},c=(e,t)=>{if(0===e)return 0;const n=Math.sign(e),a=Math.abs(e),r=1/t;return n*(a-.5*r)+n*(r-(a+.5*r)%r)},u=({min:e,max:t,percentage:n})=>e+(t-e)*n,g=({min:e,max:t,value:n})=>(n-e)/(t-e),d={37:-1,38:1,39:1,40:-1},p=e=>t=>{const n=d[t.keyCode]??0;n&&(t.preventDefault(),e({type:"STEPS",direction:n}))},m=(e,t)=>{const{centerX:n,centerY:a}=(e=>{const t=e.getBoundingClientRect();return{centerX:t.x+e.clientWidth/2,centerY:t.y+e.clientHeight/2}})(e),r=t.clientX-n,s=t.clientY-a,i=180*Math.atan2(s,r)/Math.PI+90,l=i<0?i+360:i;return{mouseX:r,mouseY:s,mouseRadius:Math.sqrt(r*r+s*s),mouseAngle:l}},h=e=>(t,n)=>{switch(n.type){case"START":return((e,t,n)=>{const a=e.mouseAngle,r=e.percentage,s=l({previousMouseAngle:null,previousPercentage:null,...e,mouseAngle:a,percentage:r,...t}),i=t.steps||e.steps,c=o(s,e,i),g=u({...e,...c});return n.onStart(),n.onInteractiveChange(g),e.tracking&&n.onChange(g),{...e,isActive:!0,...c,startPercentage:e.percentage,startValue:e.value,value:g}})(t,n,e);case"MOVE":return((e,t,n)=>{const a=e.mouseAngle,r=e.percentage,s=l({previousMouseAngle:e.mouseAngle,previousPercentage:e.percentage,...e,mouseAngle:a,percentage:r,...t}),i=t.steps||e.steps,c=o(s,e,i),g=u({...e,...c});return n.onInteractiveChange(g),e.tracking&&n.onChange(g),{...e,...c,value:g}})(t,n,e);case"STOP":return((e,t,n)=>(null!==e.value&&(e.tracking||n.onChange(e.value)),n.onEnd(),{...e,isActive:!1,value:e.value,percentage:e.percentage,startPercentage:void 0,startValue:void 0}))(t,0,e);case"CANCEL":return((e,t,n)=>{const a=e.startPercentage,r=e.startValue;return n.onEnd(),e.tracking&&n.onChange(r),{...e,isActive:!1,value:r,percentage:a,startPercentage:void 0,startValue:void 0}})(t,0,e);case"STEPS":return((e,t,n)=>{if(void 0===t.direction)throw Error("Missing direction from Steps action");if(null===e.value)return e;const a=s(e.min,e.max,e.value+1*t.direction);return n.onChange(a),{...e,value:a,percentage:g({...e,value:a})}})(t,n,e);default:return{...t,isActive:!1,value:t.value}}},v=({min:e,max:t,multiRotation:n,initialValue:a,angleOffset:s=0,angleRange:i=360,size:l,steps:o,onChange:c,onInteractiveChange:u,interactiveHook:g,onStart:d,onEnd:v,readOnly:f,tracking:x,useMouseWheel:y})=>{const $=(0,r.useRef)(null),j=(0,r.useRef)(null),C={onChange:c,onInteractiveChange:u,onStart:d,onEnd:v},[{percentage:w,value:k},E]=(0,r.useReducer)(h(C),{isActive:!1,min:e,max:t,multiRotation:n,angleOffset:s,angleRange:i,mouseAngle:null,percentage:a?(a-e)/(t-e):0,value:a||0,svg:$,tracking:x,container:j,size:l,steps:o});return(0,r.useEffect)((({container:e,dispatch:t,readOnly:n,useMouseWheel:a,interactiveHook:r})=>()=>{if(n)return;const s=e.current,i=Object(),l=(e,t)=>{let n={};if(r){const a={ctrlKey:t.ctrlKey,altKey:t.altKey,metaKey:t.metaKey,shiftKey:t.shiftKey,...e};n=r(a)}return n},o=e=>{if("mouse"===e.pointerType&&0!==e.button)return;const n=m(s,e),a=l(n,e);a.readOnly||(e.preventDefault(),e.stopPropagation(),window.PointerEvent?(i.capturedPointerId=e.pointerId,s.setPointerCapture(i.capturedPointerId),s.addEventListener("pointermove",u),s.addEventListener("pointerup",g),s.addEventListener("pointercancel",d)):(window.addEventListener("mousemove",u),window.addEventListener("mouseup",g),i.capturedWindow=!0),s.addEventListener("contextmenu",p),i.capturedContextMenu=!0,t({type:"START",...n,...a}))},c=()=>{void 0!==i.capturedPointerId&&(s.releasePointerCapture(i.capturedPointerId),s.removeEventListener("pointermove",u),s.removeEventListener("pointerup",g),s.removeEventListener("pointercancel",d),i.capturedPointerId=void 0),i.capturedWindow&&(window.removeEventListener("mousemove",u),window.removeEventListener("mouseup",g),i.capturedWindow=!1),i.capturedContextMenu&&(s.removeEventListener("contextmenu",p),i.capturedContextMenu=!1)},u=e=>{e.preventDefault(),e.stopPropagation();const n=m(s,e),a=l(n,e);a.readOnly||t({type:"MOVE",...n,...a})},g=()=>{c(),t({type:"STOP"})},d=()=>{c(),t({type:"CANCEL"})},p=e=>(e.preventDefault(),e.stopPropagation(),c(),t({type:"CANCEL"}),!1),h=a?(e=>t=>{const n=t.deltaX<0||t.deltaY>0?1:t.deltaX>0||t.deltaY<0?-1:0;t.preventDefault(),e({type:"STEPS",direction:n})})(t):null,v=window.PointerEvent?"pointerdown":"mousedown";return s.addEventListener(v,o),h&&s.addEventListener("wheel",h),()=>{c(),s.removeEventListener(v,o),h&&s.removeEventListener("wheel",h)}})({container:j,dispatch:E,readOnly:f,useMouseWheel:y,interactiveHook:g}),[y,f]),{svg:$,container:j,percentage:w,value:k,onKeyDown:p(E)}},f=(e,t,n)=>({x:e+t*Math.cos(n),y:e+t*Math.sin(n)}),x=e=>Math.PI*e/180,y=({color:e,percentage:t,percentageFrom:n=null,percentageTo:r=null,...s})=>{let i,l;if(null!==n&&null!==r?(i=n,l=r):null!==n?(i=n,l=t):null!==r?(i=t,l=r):(i=0,l=t),null===i||null===l)return(0,a.jsx)(a.Fragment,{});const o=(({percentageFrom:e,percentageTo:t,angleOffset:n,angleRange:a,arcWidth:r,radius:s,center:i})=>{const l=(e=>e>=360?359.999:e<=-360?-359.999:e)(a*(t-e)),o=n-90+a*e,c=s-r,u=x(o),g=x(o+l),d=Math.abs(l)<180?0:1,p=l>=0?1:0,m=f(i,s,u),h=f(i,s,g),v=f(i,c,g),y=f(i,c,u);return`M${m.x},${m.y} A${s},${s} 0 ${d} ${p} ${h.x},${h.y}L${v.x},${v.y} A${c},${c} 0 ${d} ${1-p} ${y.x},${y.y} L${m.x},${m.y}`})({...s,percentageFrom:i,percentageTo:l});return(0,a.jsx)("g",{children:(0,a.jsx)("path",{d:o,style:{fill:e}})})},$=({percentage:e,color:t,background:n,...r})=>(0,a.jsxs)("g",{children:[n&&(0,a.jsx)(y,{percentage:e,percentageFrom:e,percentageTo:1,color:n,...r}),(0,a.jsx)(y,{percentage:e,percentageFrom:0,percentageTo:e,color:t,...r})]}),j=({type:e,width:t,height:n,color:r,className:s})=>{switch(e){case"rect":return(0,a.jsx)("rect",{x:.5*-t,width:t,height:n,fill:r,className:s});case"circle":return(0,a.jsx)("circle",{r:t,fill:r,className:s});case"triangle":const e=`M 0,0 L ${t/2},${n} L ${-t/2},${n} z`;return(0,a.jsx)("path",{d:e,fill:r,className:s})}return(0,a.jsx)(a.Fragment,{})},C=({children:e,width:t,height:n=t,angleOffset:s,angleRange:i,percentage:l,useRotation:o=!0,radius:c,center:u,type:g,color:d,className:p})=>{if(null===l)return(0,a.jsx)(a.Fragment,{});let m;if(o)m=`rotate(${s+i*l} ${u} ${u})\n\t\t\t\t\ttranslate( ${u} ${u-c-n})`;else{const e=(s+i*l-90)*Math.PI/180;m=`translate(${u+c*Math.cos(e)} ${u+c*Math.sin(e)})`}return(0,a.jsxs)("g",{transform:m,children:[e&&r.Children.map(e,e=>(0,r.isValidElement)(e)?r.cloneElement(e,{width:t??0,height:n??0,percentage:l}):e),g&&(0,a.jsx)(j,{type:g,width:t,height:n,color:d,className:p})]})},w=({angleRange:e,steps:t,type:n="rect",radius:r,tickWidth:s,tickHeight:i,angleOffset:l,center:o,color:c,activeColor:u=c,className:g,activeClassName:d=g,fn:p,percentage:m})=>{const h=e/t,v=t+(360===e?0:1),f=o-s/2,x=o-r;if(null===m)return(0,a.jsx)(a.Fragment,{});const y=Math.round((v-1)*m);const $="circle"===n?(({tickWidth:e,translateX:t,translateY:n,angleOffset:r,stepSize:s,center:i,color:l,active:o,activeColor:c,activeClassName:u,className:g})=>(d,p)=>(0,a.jsx)("circle",{r:e,className:p===o?u:g,fill:p===o?c:l,stroke:"none",transform:`\n        rotate(${r+s*p} ${i} ${i}) \n        translate(${t} ${n})\n        `},p))({tickWidth:s,translateX:f,translateY:x,center:o,angleOffset:l,stepSize:h,color:c,active:y,activeColor:u,className:g,activeClassName:d}):"rect"!==n||p?p?null===m?(0,a.jsx)(a.Fragment,{}):(({fn:e,...t})=>(n,a)=>e({...t,i:a}))({fn:p,tickWidth:s,tickHeight:i,translateX:f,translateY:x,angleOffset:l,stepSize:h,center:o,color:c,active:y,activeColor:u,className:g,activeClassName:d,steps:t,percentage:m}):void 0:(({tickWidth:e,tickHeight:t,translateX:n,translateY:r,angleOffset:s,stepSize:i,center:l,color:o,active:c,activeColor:u,activeClassName:g,className:d})=>(p,m)=>(0,a.jsx)("rect",{className:m===c?g:d,fill:m===c?u:o,stroke:"none",width:e,height:t,transform:`\n        rotate(${s+i*m} ${l} ${l}) \n        translate(${n} ${r})\n        `},m))({tickWidth:s,tickHeight:i,translateX:f,translateY:x,angleOffset:l,stepSize:h,center:o,color:c,active:y,activeColor:u,className:g,activeClassName:d});return(0,a.jsx)("g",{children:Array.from({length:v},$)})},k=({value:e,size:t,decimalPlace:n=0,className:r,marginBottom:s=0})=>{if(null==e)return(0,a.jsx)(a.Fragment,{});let i=e.toFixed(n);return i.startsWith("-")&&0===Number.parseFloat(i)&&(i=i.slice(1)),(0,a.jsx)("text",{style:{userSelect:"none"},x:"50%",textAnchor:"middle",className:r,y:(t??0)-s,children:i})},E=(e,t,n)=>({x:e+t*Math.cos(n),y:e+t*Math.sin(n)}),M=e=>Math.PI*e/180;const A=({color:e,percentage:t,percentageFrom:n=null,radiusFrom:r=null,percentageTo:s=null,radiusTo:i=null,...l})=>{let o,c;if(null!==n&&null!==s?(o=n,c=s):null!==n?(o=n,c=t):null!==s?(o=t,c=s):(o=0,c=t),null===r||null===i)return(0,a.jsx)(a.Fragment,{});if(null===o||null===c)return(0,a.jsx)(a.Fragment,{});const u=(({percentageFrom:e,percentageTo:t,angleOffset:n,angleRange:a,arcWidth:r,outerRadiusFrom:s,outerRadiusTo:i,center:l})=>{const[o,c,u,g]=function(e,t,n,a){return e<=n?[e,t,n,a]:[n,a,e,t]}(e,s,t,i),d=a*(u-o),p=n-90+a*o,m=M(p),h=M(p+d),v=4*Math.ceil(u-o);let f="",x="",y="",$="";for(let j=0;j<=v;j++){const e=j/v,t=c+(g-c)*e,n=t-r,a=m+(h-m)*e,s=180*a/Math.PI*e,i=E(l,t,a),o=E(l,n,a);0===j?x=`${i.x},${i.y} `:f+=`${t},${t} ${s} 0 1 ${i.x},${i.y} `,j===v?$=`${o.x},${o.y} `:y=`${n},${n} ${s} 0 0 ${o.x},${o.y} `+y}return`M ${x}A ${f}L ${$}A ${y}z`})({percentageFrom:o,percentageTo:c,outerRadiusFrom:r,outerRadiusTo:i,...l});return(0,a.jsx)("g",{children:(0,a.jsx)("path",{d:u,style:{fill:e}})})},R=({label:e,angleRange:t,angleOffset:n,percentage:r,center:s,radius:i=0,className:l,style:o={},userSelect:c="none"})=>{if(!e||null===r)return(0,a.jsx)(a.Fragment,{});const u=((e,t,n)=>{const a=n*Math.PI/180;return{x:e+t*Math.cos(a),y:e+t*Math.sin(a)}})(s,i,n+90+t*r);return(0,a.jsx)("g",{transform:`translate( ${s-u.x} ${s-u.y})`,children:(0,a.jsx)("text",{style:{userSelect:c,...o},x:"50%",y:"50%",textAnchor:"middle",className:l,dominantBaseline:"middle",children:e})})},P=({min:e,max:t,value:n,multiRotation:s=!1,angleOffset:i=0,angleRange:l=360,size:o,onChange:c=()=>{},onInteractiveChange:u=()=>{},interactiveHook:g,onStart:d=()=>{},onEnd:p=()=>{},children:m,steps:h,snap:f=!1,tracking:x=!0,readOnly:j=!1,useMouseWheel:E=!0,ariaValueText:M,ariaLabelledBy:P,className:N})=>{const{percentage:O,value:S,svg:T,container:b,onKeyDown:F}=v({min:e,max:t,multiRotation:s,initialValue:n,angleOffset:i,angleRange:l,size:o,steps:f?h:void 0,onChange:c,onInteractiveChange:u,interactiveHook:g,useMouseWheel:E,readOnly:j,tracking:x,onStart:d,onEnd:p});return(0,a.jsx)("div",{ref:b,tabIndex:"0",style:{outline:"none",width:o,height:o},"aria-valuemax":t,"aria-valuemin":e,"aria-valuenow":S,"aria-valuetext":M,"aria-labelledby":P,onKeyDown:j?void 0:F,className:N,children:(0,a.jsx)("svg",{width:o,height:o,ref:T,children:r.Children.map(m,e=>(0,r.isValidElement)(e)&&(({type:e})=>e===$||e===C||e===w||e===k||e===y||e===A||e===R)(e)?r.cloneElement(e,{percentage:O,size:o,value:S,angleOffset:i,angleRange:l,radius:o/2,center:o/2,steps:h,...e.props}):e)})})}},3943(e,t,n){n.d(t,{R:()=>i,x:()=>l});var a=n(2128);const r={},s=a.createContext(r);function i(e){const t=a.useContext(s);return a.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),a.createElement(s.Provider,{value:t},e.children)}},9048(e,t,n){n.r(t),n.d(t,{assets:()=>h,contentTitle:()=>m,default:()=>x,frontMatter:()=>p,metadata:()=>a,toc:()=>v});const a=JSON.parse('{"id":"examples/async","title":"Async","description":"Example with physical motors","source":"@site/docs/3_examples/4_async.mdx","sourceDirName":"3_examples","slug":"/examples/async","permalink":"/rc-knob/examples/async","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"Async","description":"Example with physical motors"},"sidebar":"tutorialSidebar","previous":{"title":"Gradient","permalink":"/rc-knob/examples/gradient"}}');var r=n(7900),s=n(3943),i=n(2128);const l=({initialPosition:e,target:t=null,velocity:n=1,onChange:a=()=>{}})=>{const s=Date.now(),[l,o]=i.useState(e),[c,u]=i.useState(s),g=(e,t)=>null!==e&&e!==t;return i.useEffect(()=>{const e=setInterval(()=>{(()=>{const e=Date.now(),r=(e-c)/1e3;let s=l;if(u(e),g(t,s)){const e=r*n;e>Math.abs(s-t)?s=t:s+=(t>s?1:-1)*e,o(s),a(s)}})()},100);return()=>clearInterval(e)},[t,c,l]),(0,r.jsxs)("div",{children:["Position: ",l.toFixed(2)," ",(0,r.jsx)("br",{}),"Target: ",g(t,l)?t.toFixed(2):"----"]})};var o=n(3045);function c({size:e,value:t,target:n=null,onChange:a=()=>{}}){const[s,l]=i.useState(null);const c=10,u=.5*e-20,g=null!==s?s:n;return(0,r.jsxs)(o.N6,{size:e,value:t,angleOffset:0,angleRange:360,min:0,max:360,onChange:a,onInteractiveChange:function(e){l(e)},onEnd:function(e){l(null)},tracking:!1,children:[(0,r.jsx)("circle",{r:u+c,cx:e/2,cy:e/2,fill:"transparent",stroke:"#ced4da",strokeWidth:c}),null!==g?(0,r.jsx)(o.Q6,{percentageFrom:t/360,percentageTo:g/360,radius:u+15,color:"#ff9800",arcWidth:c}):"",null!==g?(0,r.jsx)(o.gm,{percentage:g/360,width:c,height:c,radius:u,type:"circle",color:"#ff9800"}):"",(0,r.jsx)(o.gm,{percentage:t/360,width:c,height:c,radius:u,type:"circle",color:"#000"}),(0,r.jsx)(o.WT,{value:null!==s?s:t,decimalPlace:2,marginBottom:e/2,className:"knob-text"})]})}function u(){const[e,t]=i.useState(45),[n,a]=i.useState(null);return(0,r.jsxs)("div",{children:[(0,r.jsx)(c,{size:120,target:n,origin:"up",min:-9999,max:9999,value:e,onChange:function(e){a(e)}}),(0,r.jsx)(l,{initialPosition:45,onChange:function(e){t(e)},velocity:30,target:n})]})}function g({size:e,value:t,target:n=null,onChange:a=()=>{}}){const[s,l]=i.useState(null);const c=10,u=.5*e-20,g=null!==s?s:n;let d=Math.abs(g-t)/360*c*1.5;return d>u&&(d=u),(0,r.jsxs)(o.N6,{size:e,value:t,angleOffset:0,angleRange:360,min:0,max:360,onChange:a,onInteractiveChange:function(e){l(e)},onEnd:function(e){l(null)},tracking:!1,multiRotation:!0,children:[(0,r.jsx)("circle",{r:u+c,cx:e/2,cy:e/2,fill:"transparent",stroke:"#ced4da",strokeWidth:c}),null!==g?(0,r.jsx)(o.An,{percentageFrom:t/360,percentageTo:g/360,radiusFrom:u+15,radiusTo:u+15-d,color:"#ff9800",arcWidth:c}):"",null!==g?(0,r.jsx)(o.gm,{percentage:g/360,width:c,height:c,radius:u-d,type:"circle",color:"#ff9800"}):"",(0,r.jsx)(o.gm,{percentage:t/360,width:c,height:c,radius:u,type:"circle",color:"#000"}),(0,r.jsx)(o.WT,{value:null!==s?s:t,decimalPlace:2,marginBottom:e/2,className:"knob-text"})]})}function d(){const[e,t]=i.useState(45),[n,a]=i.useState(null);return(0,r.jsxs)("div",{children:[(0,r.jsx)(g,{size:120,target:n,origin:"up",min:-9999,max:9999,value:e,onChange:function(e){a(e)}}),(0,r.jsx)(l,{initialPosition:45,onChange:function(e){t(e)},velocity:30,target:n})]})}const p={title:"Async",description:"Example with physical motors"},m=void 0,h={},v=[{value:"Rotative device",id:"rotative-device",level:3},{value:"Rotative device multiturns",id:"rotative-device-multiturns",level:3}];function f(e){const t={h3:"h3",p:"p",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.p,{children:"Such examples show how the component can be used on hardware controller limited\nby a velocity like a motor."}),"\n",(0,r.jsx)(t.h3,{id:"rotative-device",children:"Rotative device"}),"\n",(0,r.jsx)(u,{}),"\n",(0,r.jsx)(t.h3,{id:"rotative-device-multiturns",children:"Rotative device multiturns"}),"\n",(0,r.jsx)(d,{})]})}function x(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(f,{...e})}):f(e)}}}]);