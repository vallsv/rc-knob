name: release

on:
  push:
    branches:
    - main

jobs:
  build-deploy:

    runs-on: ubuntu-latest

    steps:

    - uses: actions/checkout@v1

    - name: Install pnpm
      uses: pnpm/action-setup@v4
      with:
        version: 10

    - name: Use Node.js 
      uses: actions/setup-node@v1
      with:
        node-version: 24.x

    - name: pnpm install, test and build
      run: |
        pnpm install
        pnpm test
        pnpm release

    - name: Semantic Release
      uses: cycjimmy/semantic-release-action@v2
      env:
        GITHUB_TOKEN: ${{ secrets.PERSONAL_TOKEN }}
        NPM_TOKEN: ${{ secrets.NPM_TOKEN }}
